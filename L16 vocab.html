<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, landscape=yes">
    <title>ç¯å¢ƒä¿æŠ¤ç›¸å…³è¯æ±‡ (45 Words) - XUSFUNCHINESE</title>
    <style>
        :root {
            --primary: #01579b; 
            --accent: #e1f5fe;  
            --gold: #fbc02d;
            --pinyin: #d0021b; 
            --night-sky: radial-gradient(circle at center, #001f3f 0%, #000510 100%);
        }
        
        body { 
            margin: 0; 
            font-family: "Arial Black", "Segoe UI", Tahoma, sans-serif; 
            background: linear-gradient(135deg, #0277bd 0%, #002f6c 100%); 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            position: relative;
        }

        /* æ°´å°ï¼šxuschineseï¼ˆæ·¡ã€æ—‹è½¬ã€å±…ä¸­ã€ä¸å½±å“äº¤äº’ï¼‰ */
        body::after {
            content: "xuschinese";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-35deg);
            font-size: 18vw;
            color: rgba(255, 255, 255, 0.06);
            font-weight: bold;
            letter-spacing: 15px;
            pointer-events: none;
            z-index: -1;
            white-space: nowrap;
            opacity: 0.6;
            font-family: "Arial Black", sans-serif;
        }

        /* æ‰€æœ‰æ±‰å­—å¼ºåˆ¶ä½¿ç”¨æ¥·ä½“ */
        ruby, .list-row b, .cover-title, .cover-subtitle, #hint-box div, #display-area {
            font-family: "KaiTi", "STKai", "æ¥·ä½“", "æ¥·ä½“_GB2312", "SimKai", serif !important;
            font-weight: normal;
        }

        #cover-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--night-sky); z-index: 5000; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; transition: opacity 0.8s ease-out, visibility 0.8s; overflow: hidden;
        }

        .star {
            position: absolute; top: 50%; left: 50%; width: 2px; height: 2px;
            background: white; border-radius: 50%; box-shadow: 0 0 10px #fff;
            animation: shoot linear infinite;
        }

        @keyframes shoot {
            0% { transform: translate(-50%, -50%) rotate(var(--angle)) translateX(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) rotate(var(--angle)) translateX(1000px); opacity: 0; width: 160px; }
        }

        .cover-content { text-align: center; z-index: 10; padding: 20px; }
        .cover-title { font-size: 10vw; color: var(--gold); line-height: 1.1; margin: 0; font-weight: 900; text-shadow: 0 0 30px rgba(251,192,45,0.8), 0 0 60px rgba(251,192,45,0.4); animation: glow 2s infinite alternate; }
        .cover-subtitle { font-size: 7vw; color: white; margin-top: 5px; font-weight: 900; }
        @keyframes glow { from { transform: scale(1); } to { transform: scale(1.05); } }

        header { 
            background: rgba(255,255,255,0.95); padding: 10px 20px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 100; 
        }
        .nav-btns button { 
            padding: 8px 12px; margin-right: 5px; border-radius: 20px; border: 2px solid var(--primary); 
            cursor: pointer; font-weight: bold; background: white; color: var(--primary);
        }
        .active-mode { background: var(--primary) !important; color: white !important; }

        main { flex: 1; display: flex; padding: 20px; gap: 15px; overflow: hidden; }
        #left-panel { flex: 1; background: rgba(255,255,255,0.95); border-radius: 30px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 4px solid var(--accent); }
        #right-panel { flex: 1.6; background: rgba(255,255,255,0.95); border-radius: 30px; padding: 30px; display: flex; flex-direction: column; overflow-y: auto; border: 4px solid var(--accent); position: relative; }

        ruby { ruby-align: center; font-size: 50px; margin: 0 4px; line-height: 2.2; font-weight: 600; }
        rt { font-size: 20px; color: var(--pinyin); font-weight: bold; }
        .eng-hint { display: block; font-size: 26px; color: #333; margin-top: 15px; border-top: 2px dashed #ccc; padding-top: 10px; }
        #emoji-display { font-size: 130px; margin-bottom: 20px; }
        
        .option-btn { background: white; border: 2px solid var(--primary); padding: 15px; margin: 8px 0; border-radius: 15px; cursor: pointer; font-size: 20px; width: 100%; transition: 0.2s; }
        
        #scroll-view { display: none; width: 100%; overflow-y: auto; padding: 30px; background: white; border-radius: 30px; }
        .list-row { border-bottom: 1px solid var(--accent); padding: 15px; cursor: pointer; display: flex; align-items: center; transition: background 0.2s; }
        .list-row:hover { background: var(--accent); }
        .hidden { display: none !important; }
        #timer-display { font-size: 24px; color: #d32f2f; font-weight: bold; margin-right: 15px; }
    </style>
</head>
<body>

<div id="cover-page" onclick="enterApp()">
    <div id="star-container"></div>
    <div class="cover-content">
        <h1 class="cover-title">ç¯ä¿</h1>
        <div class="cover-subtitle">45 Vocabulary Words</div>
        <div style="color:white; margin-top:20px; letter-spacing:3px;">CLICK TO START</div>
    </div>
</div>

<header>
    <div class="nav-btns">
        <button onclick="setMode('study')" id="btn-study">ğŸ“– Learn</button>
        <button onclick="setMode('review')" id="btn-review">ğŸ”„ Review</button>
        <button onclick="setMode('quiz')" id="btn-quiz">âš¡ Quiz</button>
        <button onclick="setMode('rush')" id="btn-rush">ğŸ”¥ Rush</button>
        <button onclick="setMode('mistakes')" id="btn-mistakes">âŒ Mistakes</button>
        <button onclick="setMode('list')" id="btn-list">ğŸ“œ List</button>
    </div>
    <div style="display: flex; align-items: center;">
        <span id="timer-display" class="hidden">00:30</span>
        <span style="font-weight: bold; color: var(--primary);">Score: <span id="score-val">0</span></span>
    </div>
</header>

<main>
    <div id="main-ui" style="display: flex; width: 100%; gap: 15px;">
        <div id="left-panel">
            <div id="emoji-display">âœ¨</div>
            <button onclick="speakItem(true)" style="padding: 15px 40px; border-radius: 50px; cursor: pointer; background: var(--primary); color: white; border: none; font-weight: bold; font-size: 20px;">ğŸ”Š Play Sound</button>
        </div>
        <div id="right-panel">
            <div id="display-area"></div>
            <div id="hint-box" style="margin-top:20px; padding:15px; background:#fffde7; border-left:8px solid var(--gold); border-radius:12px;"></div>
            <div id="interaction-area" style="margin-top: 15px;"></div>
        </div>
    </div>
    <div id="scroll-view"></div>
</main>

<script>
    const database = [
        ["ä¿æŠ¤", "bÇohÃ¹", "to protect, to safeguard", "ğŸ›¡ï¸", {cn: "æˆ‘ä»¬è¦ä¿æŠ¤åœ°çƒã€‚", py: "wÇ’men yÃ o bÇohÃ¹ dÃ¬qiÃº", en: "We must protect the Earth."}],
        ["èŠ‚çº¦", "jiÃ©yuÄ“", "to economize, to save, to conserve", "ğŸ’¡", {cn: "æˆ‘ä»¬è¦èŠ‚çº¦æ°´ã€‚", py: "wÇ’men yÃ o jiÃ©yuÄ“ shuÇ", en: "We should conserve water."}],
        ["èƒ½æº", "nÃ©ngyuÃ¡n", "energy, energy source", "âš¡", {cn: "å¤ªé˜³èƒ½æ˜¯ä¸€ç§èƒ½æºã€‚", py: "tÃ iyÃ¡ngnÃ©ng shÃ¬ yÄ« zhÇ’ng nÃ©ngyuÃ¡n", en: "Solar energy is a type of energy source."}],
        ["çˆ¬å±±", "pÃ¡ shÄn", "to hike in the mountains, to climb a mountain", "ğŸ”ï¸", {cn: "å‘¨æœ«æˆ‘å»çˆ¬å±±ã€‚", py: "zhÅumÃ² wÇ’ qÃ¹ pÃ¡ shÄn", en: "I go mountain hiking on weekends."}],
        ["æœ‰ç›Š", "yÇ’uyÃ¬", "beneficial, useful", "âœ…", {cn: "çˆ¬å±±å¯¹èº«ä½“æœ‰ç›Šã€‚", py: "pÃ¡ shÄn duÃ¬ shÄ“ntÇ yÇ’uyÃ¬", en: "Mountain climbing is beneficial to the body."}],
        ["äº", "yÃº", "towards, in, on, at (comparison)", "â¡ï¸", {cn: "ä¿æŠ¤ç¯å¢ƒå¯¹æˆ‘ä»¬æœ‰ç›Šã€‚", py: "bÇohÃ¹ huÃ¡njÃ¬ng duÃ¬ wÇ’men yÇ’uyÃ¬", en: "Protecting the environment is beneficial to us."}],
        ["æ®µ", "duÃ n", "section, segment, part (measure word)", "ğŸ“", {cn: "æˆ‘æ¯å¤©é”»ç‚¼ä¸€æ®µã€‚", py: "wÇ’ mÄ›itiÄn duÃ nliÃ n yÄ« duÃ n", en: "I exercise for a period every day."}],
        ["æ¨", "tuÄ«", "to push, to shove", "ğŸ‘‰", {cn: "è¯·æŠŠé—¨æ¨å¼€ã€‚", py: "qÇng bÇ mÃ©n tuÄ« kÄi", en: "Please push the door open."}],
        ["ç©ºæ°”", "kÅngqÃ¬", "air, atmosphere", "ğŸ’¨", {cn: "ä»Šå¤©çš„ç©ºæ°”ä¸å¥½ã€‚", py: "jÄ«ntiÄn de kÅngqÃ¬ bÃ¹ hÇo", en: "Today's air is not good."}],
        ["é›¾éœ¾", "wÃ¹mÃ¡i", "smog", "ğŸŒ«ï¸", {cn: "åŒ—äº¬æœ‰é›¾éœ¾ã€‚", py: "bÄ›ijÄ«ng yÇ’u wÃ¹mÃ¡i", en: "Beijing has smog."}],
        ["å›æ”¶", "huÃ­shÅu", "to recycle", "â™»ï¸", {cn: "æˆ‘ä»¬è¦å›æ”¶ç“¶å­ã€‚", py: "wÇ’men yÃ o huÃ­shÅu pÃ­ngzi", en: "We should recycle bottles."}],
        ["ç­’", "tÇ’ng", "thick tube-shaped container", "ğŸ—‘ï¸", {cn: "è¿™æ˜¯å›æ”¶ç­’ã€‚", py: "zhÃ¨ shÃ¬ huÃ­shÅu tÇ’ng", en: "This is a recycling bin."}],
        ["æ‰”", "rÄ“ng", "to throw, to toss, to throw away", "ğŸ—‘ï¸", {cn: "ä¸è¦ä¹±æ‰”åƒåœ¾ã€‚", py: "bÃ¹ yÃ o luÃ n rÄ“ng lÄjÄ«", en: "Don't litter."}],
        ["ç“¶è£…æ°´", "pÃ­ngzhuÄng shuÇ", "bottled water", "ğŸ¼", {cn: "æˆ‘å–ç“¶è£…æ°´ã€‚", py: "wÇ’ hÄ“ pÃ­ngzhuÄng shuÇ", en: "I drink bottled water."}],
        ["åœ°çƒ", "dÃ¬qiÃº", "the earth, the globe", "ğŸŒ", {cn: "åœ°çƒæ˜¯æˆ‘ä»¬å®¶ã€‚", py: "dÃ¬qiÃº shÃ¬ wÇ’men jiÄ", en: "The Earth is our home."}],
        ["äº®", "liÃ ng", "bright, light", "ğŸ’¡", {cn: "å¤ªé˜³å¾ˆäº®ã€‚", py: "tÃ iyÃ¡ng hÄ›n liÃ ng", en: "The sun is very bright."}],
        ["å¤ªé˜³", "tÃ iyÃ¡ng", "sun", "â˜€ï¸", {cn: "ä»Šå¤©å¤ªé˜³å¾ˆå¤§ã€‚", py: "jÄ«ntiÄn tÃ iyÃ¡ng hÄ›n dÃ ", en: "The sun is very strong today."}],
        ["å¤ªé˜³èƒ½", "tÃ iyÃ¡ngnÃ©ng", "solar energy, solar power", "â˜€ï¸âš¡", {cn: "æˆ‘ä»¬ç”¨å¤ªé˜³èƒ½å‘ç”µã€‚", py: "wÇ’men yÃ²ng tÃ iyÃ¡ngnÃ©ng fÄ diÃ n", en: "We use solar energy to generate electricity."}],
        ["æ¿", "bÇn", "board, plank, panel", "ğŸªµ", {cn: "å¤ªé˜³èƒ½æ¿å¾ˆå¤§ã€‚", py: "tÃ iyÃ¡ngnÃ©ng bÇn hÄ›n dÃ ", en: "Solar panels are very large."}],
        ["å‘ç”µ", "fÄ diÃ n", "to generate electricity", "âš¡", {cn: "å¤ªé˜³èƒ½å¯ä»¥å‘ç”µã€‚", py: "tÃ iyÃ¡ngnÃ©ng kÄ›yÇ fÄ diÃ n", en: "Solar energy can generate electricity."}],
        ["å›½å®¶", "guÃ³jiÄ", "country, nation", "ğŸ‡¨ğŸ‡³", {cn: "ä¸­å›½æ˜¯æˆ‘çš„å›½å®¶ã€‚", py: "zhÅngguÃ³ shÃ¬ wÇ’ de guÃ³jiÄ", en: "China is my country."}],
        ["å±æœº", "wÄ“ijÄ«", "crisis", "âš ï¸", {cn: "æˆ‘ä»¬é¢ä¸´ç¯å¢ƒå±æœºã€‚", py: "wÇ’men miÃ nlÃ­n huÃ¡njÃ¬ng wÄ“ijÄ«", en: "We are facing an environmental crisis."}],
        ["é£", "fÄ“ng", "wind", "ğŸŒ¬ï¸", {cn: "ä»Šå¤©æœ‰å¤§é£ã€‚", py: "jÄ«ntiÄn yÇ’u dÃ  fÄ“ng", en: "It's very windy today."}],
        ["çŸ³æ²¹", "shÃ­yÃ³u", "petroleum, oil", "ğŸ›¢ï¸", {cn: "çŸ³æ²¹æ˜¯ä¸€ç§èƒ½æºã€‚", py: "shÃ­yÃ³u shÃ¬ yÄ« zhÇ’ng nÃ©ngyuÃ¡n", en: "Petroleum is a type of energy source."}],
        ["ç…¤", "mÃ©i", "coal", "âš«", {cn: "ç…¤æ±¡æŸ“ç©ºæ°”ã€‚", py: "mÃ©i wÅ«rÇn kÅngqÃ¬", en: "Coal pollutes the air."}],
        ["è§„å®š", "guÄ«dÃ¬ng", "to regulate; rules and regulations", "ğŸ“œ", {cn: "å­¦æ ¡æœ‰è®¸å¤šè§„å®šã€‚", py: "xuÃ©xiÃ o yÇ’u xÇ”duÅ guÄ«dÃ¬ng", en: "The school has many regulations."}],
        ["å…¬å…±åœºæ‰€", "gÅnggÃ²ng chÇngsuÇ’", "public place", "ğŸ›ï¸", {cn: "å…¬å…±åœºæ‰€ä¸èƒ½å¸çƒŸã€‚", py: "gÅnggÃ²ng chÇngsuÇ’ bÃ¹ nÃ©ng xÄ«yÄn", en: "No smoking in public places."}],
        ["æš–æ°”", "nuÇnqÃ¬", "heating", "ğŸ”¥", {cn: "å†¬å¤©è¦å¼€æš–æ°”ã€‚", py: "dÅngtiÄn yÃ o kÄi nuÇnqÃ¬", en: "We need to turn on the heating in winter."}],
        ["æ¸©åº¦", "wÄ“ndÃ¹", "temperature", "ğŸŒ¡ï¸", {cn: "ä»Šå¤©çš„æ¸©åº¦å¾ˆé«˜ã€‚", py: "jÄ«ntiÄn de wÄ“ndÃ¹ hÄ›n gÄo", en: "Today's temperature is very high."}],
        ["åº¦", "dÃ¹", "degree (measure word)", "ğŸ“", {cn: "ç°åœ¨ä¸‰ååº¦ã€‚", py: "xiÃ nzÃ i sÄnshÃ­ dÃ¹", en: "It's 30 degrees now."}],
        ["èµæˆ", "zÃ nchÃ©ng", "to approve, to support", "ğŸ‘", {cn: "æˆ‘èµæˆä½ çš„æ„è§ã€‚", py: "wÇ’ zÃ nchÃ©ng nÇ de yÃ¬jiÃ n", en: "I approve of your opinion."}],
        ["å‡ºæ±—", "chÅ« hÃ n", "to sweat", "ğŸ’¦", {cn: "è¿åŠ¨ä»¥åæˆ‘å‡ºæ±—ã€‚", py: "yÃ¹ndÃ²ng yÇhÃ²u wÇ’ chÅ« hÃ n", en: "I sweat after exercising."}],
        ["é¤å…·", "cÄnjÃ¹", "tableware, eating utensils", "ğŸ½ï¸", {cn: "è¯·ç”¨è‡ªå·±çš„é¤å…·ã€‚", py: "qÇng yÃ²ng zÃ¬jÇ de cÄnjÃ¹", en: "Please use your own tableware."}],
        ["ä¸€æ¬¡æ€§", "yÃ­cÃ¬xÃ¬ng", "one-time, disposable", "ğŸ—‘ï¸", {cn: "ä¸è¦ç”¨ä¸€æ¬¡æ€§é¤å…·ã€‚", py: "bÃ¹ yÃ o yÃ²ng yÃ­cÃ¬xÃ¬ng cÄnjÃ¹", en: "Don't use disposable tableware."}],
        ["ç ", "kÇn", "to cut, to chop", "ğŸª“", {cn: "ä¸è¦ä¹±ç æ ‘æœ¨ã€‚", py: "bÃ¹ yÃ o luÃ n kÇn shÃ¹mÃ¹", en: "Don't randomly cut down trees."}],
        ["è¶…å¸‚", "chÄoshÃ¬", "supermarket", "ğŸª", {cn: "è¶…å¸‚æœ‰è®¸å¤šå¡‘æ–™è¢‹ã€‚", py: "chÄoshÃ¬ yÇ’u xÇ”duÅ sÃ¹liÃ o dÃ i", en: "Supermarkets have many plastic bags."}],
        ["å¡‘æ–™è¢‹", "sÃ¹liÃ o dÃ i", "plastic bag", "ğŸ›ï¸", {cn: "å¡‘æ–™è¢‹é€ æˆæ±¡æŸ“ã€‚", py: "sÃ¹liÃ o dÃ i zÃ o chÃ©ng wÅ«rÇn", en: "Plastic bags cause pollution."}],
        ["å‡å°‘", "jiÇnshÇo", "to reduce, to decrease", "ğŸ“‰", {cn: "æˆ‘ä»¬è¦å‡å°‘ä½¿ç”¨å¡‘æ–™è¢‹ã€‚", py: "wÇ’men yÃ o jiÇnshÇo shÇyÃ²ng sÃ¹liÃ o dÃ i", en: "We should reduce the use of plastic bags."}],
        ["æ±¡æŸ“", "wÅ«rÇn", "to pollute; pollution", "â˜ ï¸", {cn: "å¡‘æ–™è¢‹æ±¡æŸ“ç¯å¢ƒã€‚", py: "sÃ¹liÃ o dÃ i wÅ«rÇn huÃ¡njÃ¬ng", en: "Plastic bags pollute the environment."}],
        ["é€ æˆ", "zÃ o chÃ©ng", "to cause, to give rise to", "â¡ï¸", {cn: "ç æ ‘é€ æˆæ°´åœŸæµå¤±ã€‚", py: "kÇn shÃ¹ zÃ o chÃ©ng shuÇtÇ” liÃºshÄ«", en: "Cutting trees causes soil erosion."}],
        ["æ¯”å¦‚", "bÇrÃº", "for example", "ğŸ’¡", {cn: "æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¸ƒè¢‹ã€‚", py: "bÇrÃº, wÇ’men kÄ›yÇ yÃ²ng bÃ¹ dÃ i", en: "For example, we can use cloth bags."}],
        ["éšæ‰‹", "suÃ­shÇ’u", "conveniently, without extra effort", "âœ‹", {cn: "éšæ‰‹å…³ç¯å¯ä»¥èŠ‚çº¦èƒ½æºã€‚", py: "suÃ­shÇ’u guÄn dÄ“ng kÄ›yÇ jiÃ©yuÄ“ nÃ©ngyuÃ¡n", en: "Turning off lights conveniently can save energy."}],
        ["åŠ æ²¹", "jiÄ yÃ³u", "to make an extra effort; come on", "ğŸ’ª", {cn: "ä¿æŠ¤ç¯å¢ƒï¼Œå¤§å®¶åŠ æ²¹ï¼", py: "bÇohÃ¹ huÃ¡njÃ¬ng, dÃ jiÄ jiÄ yÃ³u", en: "Protect the environment, everyone come on!"}],
        ["é©¬å…‹", "MÇkÃ¨", "Mark (name)", "ğŸ‘¨", {cn: "é©¬å…‹å¾ˆæ³¨æ„ç¯ä¿ã€‚", py: "MÇkÃ¨ hÄ›n zhÃ¹yÃ¬ huÃ¡nbÇo", en: "Mark pays great attention to environmental protection."}],
        ["æ‘„æ°", "ShÃ¨shÃ¬", "Celsius", "ğŸŒ¡ï¸", {cn: "ä»Šå¤©æ˜¯æ‘„æ°ä¸‰ååº¦ã€‚", py: "jÄ«ntiÄn shÃ¬ ShÃ¨shÃ¬ sÄnshÃ­ dÃ¹", en: "Today is 30 degrees Celsius."}]
    ];

    let currentMode = 'study', currentIndex = 0, score = 0, timer = null, timeLeft = 30;
    let mistakes = [];

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playEffect(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        if(type === 'win') {
            osc.frequency.setValueAtTime(987, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1318, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        } else {
            osc.type = 'sawtooth'; osc.frequency.setValueAtTime(220, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(110, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        }
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
    }

    function initStars() {
        const container = document.getElementById('star-container');
        for(let i=0; i<100; i++) {
            let s = document.createElement('div'); s.className = 'star';
            s.style.setProperty('--angle', Math.random() * 360 + 'deg');
            s.style.animationDuration = Math.random() * 1.5 + 0.8 + 's';
            container.appendChild(s);
        }
    }

    function enterApp() {
        document.getElementById('cover-page').style.opacity = '0';
        setTimeout(() => { document.getElementById('cover-page').style.visibility = 'hidden'; }, 800);
        setMode('study');
    }

    function speakText(text, callback = null) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(text);
        m.lang = 'zh-CN'; m.rate = 0.85;
        if (callback) m.onend = callback;
        window.speechSynthesis.speak(m);
    }

    function speakItem(withExample = false) {
        const itemIndex = currentMode === 'mistakes' ? mistakes[currentIndex].index : currentIndex;
        const item = database[itemIndex];
        if (withExample) speakText(item[0], () => setTimeout(() => speakText(item[4].cn), 400));
        else speakText(item[0]);
    }

    function speakExample() {
        const itemIndex = currentMode === 'mistakes' ? mistakes[currentIndex].index : currentIndex;
        const item = database[itemIndex];
        speakText(item[4].cn);
    }

    function setMode(m, jumpIndex = 0) {
        currentMode = m; 
        currentIndex = jumpIndex; 
        clearInterval(timer);
        document.querySelectorAll('.nav-btns button').forEach(b => b.classList.remove('active-mode'));
        if(document.getElementById('btn-'+m)) document.getElementById('btn-'+m).classList.add('active-mode');
        document.getElementById('timer-display').classList.add('hidden');
        score = 0;
        document.getElementById('score-val').innerText = "0";

        if (m === 'rush') {
            timeLeft = 30;
            document.getElementById('timer-display').classList.remove('hidden');
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer-display').innerText = `00:${timeLeft < 10 ? '0'+timeLeft : timeLeft}`;
                if (timeLeft <= 0) { 
                    clearInterval(timer); 
                    const praises = ["æ—¶é—´åˆ°ï¼", "ä¸é”™å“¦ï¼"];
                    speakText(praises[Math.floor(Math.random()*praises.length)]);
                    setMode('study'); 
                }
            }, 1000);
        }

        if(m === 'list') {
            document.getElementById('main-ui').classList.add('hidden');
            document.getElementById('scroll-view').style.display = 'block';
            renderList();
        } else {
            document.getElementById('main-ui').classList.remove('hidden');
            document.getElementById('scroll-view').style.display = 'none';
            render();
        }
    }

    function generateRubyHtml(text, pinyinStr) {
        const chars = text.split('');
        const pys = pinyinStr.split(' ');
        let html = "";
        let pyIdx = 0;
        chars.forEach(c => {
            if(/[\u4e00-\u9fa5]/.test(c)) {
                html += `<ruby>${c}<rt>${pys[pyIdx] || ''}</rt></ruby>`;
                pyIdx++;
            } else {
                html += c;
            }
        });
        return html;
    }

    function showMainPinyinAndMeaning() {
        const itemIndex = currentMode === 'mistakes' ? mistakes[currentIndex].index : currentIndex;
        const item = database[itemIndex];
        const display = document.getElementById('display-area');
        display.innerHTML = generateRubyHtml(item[0], item[1]) + `<span class="eng-hint">${item[2]}</span>`;
        display.onclick = null;
        display.style.cursor = 'default';
        speakItem(false);
    }

    function showExampleFull() {
        const itemIndex = currentMode === 'mistakes' ? mistakes[currentIndex].index : currentIndex;
        const item = database[itemIndex];
        const hint = document.getElementById('hint-box');
        hint.innerHTML = `<div style="font-size:26px;">${generateRubyHtml(item[4].cn, item[4].py)}</div><div style="font-style:italic; color:#666;">${item[4].en}</div><div style="font-size:12px; color:#999; margin-top:5px; text-align:right;">ğŸ”Š ç‚¹å‡»æœ—è¯»ä¾‹å¥</div>`;
        hint.onclick = () => speakExample();
        speakExample();
    }

    function render() {
        const display = document.getElementById('display-area');
        const interaction = document.getElementById('interaction-area');
        const hint = document.getElementById('hint-box');
        display.innerHTML = ""; interaction.innerHTML = ""; hint.innerHTML = "";

        if (currentMode === 'mistakes' && mistakes.length === 0) {
            display.innerHTML = "<h2 style='text-align:center; color:#d32f2f;'>é”™é¢˜æœ¬ä¸ºç©ºï¼</h2>";
            interaction.innerHTML = `<button class="option-btn" onclick="setMode('study')" style="background:var(--primary); color:white;">è¿”å›å­¦ä¹ æ¨¡å¼</button>`;
            document.getElementById('emoji-display').innerText = "ğŸ“­";
            return;
        }

        const itemIndex = currentMode === 'mistakes' ? mistakes[currentIndex].index : currentIndex;
        const item = database[itemIndex];
        document.getElementById('emoji-display').innerText = item[3];

        if (currentMode === 'study') {
            // ä¸»è¯ï¼šåˆå§‹çº¯æ±‰å­—ï¼Œç‚¹å‡»æ˜¾ç¤ºæ‹¼éŸ³+å«ä¹‰
            display.innerHTML = `<div style="text-align:center; cursor:pointer;" onclick="showMainPinyinAndMeaning()">
                <h1 style="font-size:80px; margin:0;">${item[0]}</h1>
                <p style="color:#888; margin-top:20px;">ç‚¹å‡»æ˜¾ç¤ºæ‹¼éŸ³å’Œå«ä¹‰</p>
            </div>`;

            // ä¾‹å¥ï¼šåˆå§‹çº¯æ±‰å­—ï¼Œç‚¹å‡»æ˜¾ç¤ºæ‹¼éŸ³+è‹±æ–‡
            hint.innerHTML = `<div style="text-align:center; cursor:pointer;" onclick="showExampleFull()">
                <div style="font-size:26px; margin-bottom:10px;">${item[4].cn}</div>
                <p style="color:#888; font-size:16px;">ç‚¹å‡»æ˜¾ç¤ºæ‹¼éŸ³å’Œç¿»è¯‘</p>
            </div>`;

            interaction.innerHTML = `<button class="option-btn" onclick="nextCard()">ä¸‹ä¸€å¼  â†’</button>`;
            speakItem(false); // åˆå§‹æœ—è¯»ä¸»è¯
        }
        else if (currentMode === 'review') {
            display.innerHTML = `<h1 style="font-size:80px; cursor:pointer;" onclick="revealReview()">${item[0]}</h1>`;
            interaction.innerHTML = `<p style="text-align:center; color:#888;">ç‚¹å‡»æ±‰å­—æ˜¾ç¤ºè¯¦æƒ…</p>`;
        }
        else {
            let isSentence = Math.random() > 0.5;
            let isEnToCn = Math.random() > 0.5;
            if (currentMode === 'mistakes') {
                isSentence = mistakes[currentIndex].isSentence;
                isEnToCn = mistakes[currentIndex].isEnToCn;
            }

            let questText, correctAns, speakTarget;
            if (isSentence) {
                questText = isEnToCn ? item[4].en : item[4].cn;
                correctAns = isEnToCn ? item[4].cn : item[4].en;
                speakTarget = item[4].cn;
            } else {
                questText = isEnToCn ? item[2] : item[0];
                correctAns = isEnToCn ? item[0] : item[2];
                speakTarget = item[0];
            }

            display.innerHTML = `<h2 style="font-size:36px; text-align:center;">${questText}</h2>`;
            
            let choices = [correctAns];
            while(choices.length < 4) {
                let r = database[Math.floor(Math.random()*database.length)];
                let val;
                if (isSentence) {
                    val = isEnToCn ? r[4].cn : r[4].en;
                } else {
                    val = isEnToCn ? r[0] : r[2];
                }
                if(!choices.includes(val)) choices.push(val);
            }
            choices.sort(() => Math.random() - 0.5);

            choices.forEach(c => {
                const b = document.createElement('button'); b.className = 'option-btn'; b.innerText = c;
                b.onclick = () => {
                    if(c === correctAns) {
                        playEffect('win');
                        speakText(speakTarget);
                        if (currentMode !== 'mistakes') score += 10;
                        document.getElementById('score-val').innerText = score;
                        b.style.background = "#4caf50"; b.style.color = "white"; 

                        if (currentMode === 'mistakes') {
                            mistakes.splice(currentIndex, 1);
                            if (mistakes.length === 0) {
                                setTimeout(() => {
                                    speakText("é”™é¢˜å…¨éƒ¨ç­”å¯¹ï¼å¤ªæ£’äº†ï¼");
                                    setMode('study');
                                }, 800);
                                return;
                            }
                        }
                        setTimeout(nextCard, 800);
                    } else { 
                        playEffect('fail');
                        b.style.background = "#f44336"; b.style.color = "white";
                        if (currentMode !== 'mistakes') {
                            const newMistake = {index: itemIndex, isSentence, isEnToCn};
                            if (!mistakes.some(m => m.index === newMistake.index && m.isSentence === newMistake.isSentence && m.isEnToCn === newMistake.isEnToCn)) {
                                mistakes.push(newMistake);
                            }
                        }
                    }
                };
                interaction.appendChild(b);
            });
        }
    }

    function revealReview() {
        const itemIndex = currentMode === 'mistakes' ? mistakes[currentIndex].index : currentIndex;
        const item = database[itemIndex];
        const display = document.getElementById('display-area');
        const hint = document.getElementById('hint-box');
        display.innerHTML = generateRubyHtml(item[0], item[1]) + `<span class="eng-hint">${item[2]}</span>`;
        hint.innerHTML = `<div style="font-size:26px;">${generateRubyHtml(item[4].cn, item[4].py)}</div><div style="font-style:italic; color:#666;">${item[4].en}</div><div style="font-size:12px; color:#999; margin-top:5px; text-align:right;">ğŸ”Š ç‚¹å‡»æœ—è¯»ä¾‹å¥</div>`;
        hint.onclick = () => speakExample();
        speakItem(true);
        document.getElementById('interaction-area').innerHTML = `<button class="option-btn" onclick="nextCard()">ä¸‹ä¸€å¼  â†’</button>`;
    }

    function nextCard() {
        if (currentMode === 'mistakes') {
            currentIndex++;
            if (currentIndex >= mistakes.length) {
                setMode('study');
                return;
            }
        } else {
            currentIndex++;
            if (currentIndex >= database.length) {
                currentIndex = 0;
                const praises = ["ä¸€è½®å®Œæˆï¼å¤ªæ£’äº†ï¼", "ä½ çœŸå‰å®³ï¼", "ç»§ç»­åŠ æ²¹ï¼"];
                speakText(praises[Math.floor(Math.random()*praises.length)]);
            }
        }
        render();
    }

    function renderList() {
        const view = document.getElementById('scroll-view');
        view.innerHTML = "<h2>ğŸ“œ ç¯å¢ƒä¿æŠ¤ç›¸å…³è¯æ±‡ (45è¯)</h2><p style='color:#666;'>ç‚¹å‡»ä»»æ„è¡Œç›´æ¥å­¦ä¹ è¯¥è¯</p>";
        database.forEach((it, idx) => {
            const r = document.createElement('div'); r.className = 'list-row';
            r.innerHTML = `<div style="min-width:40px; color:#999;">${idx+1}</div>
                <div style="font-size:32px; margin-right:15px;">${it[3]}</div>
                <div style="flex:1;"><b>${it[0]}</b> <span style="color:var(--pinyin);">[${it[1]}]</span><br><small>${it[2]}</small></div>`;
            r.onclick = () => { setMode('study', idx); };
            view.appendChild(r);
        });
    }

    window.onload = () => { initStars(); };
</script>
</body>
</html>
